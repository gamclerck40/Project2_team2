{% extends "base.html" %}
{% load humanize %}
{% block content %}
<div style="max-width: 800px; margin: 40px auto; padding: 0 20px; font-family: sans-serif;">

    <div style="background: #1a1a1a; color: #fff; padding: 35px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <h2 style="margin: 0 0 20px 0; font-size: 22px;">ğŸŸï¸ ì¿ í° ë“±ë¡</h2>
        <form method="post" action="{% url 'register_coupon' %}" style="display: flex; gap: 10px;">
            {% csrf_token %}
            <input type="text" name="coupon_code" placeholder="ì¿ í° ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”" required
                   style="flex: 1; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #252525; color: #fff; outline: none;">
            <button type="submit" style="padding: 0 25px; background: #fbc02d; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: #000;">
                ë“±ë¡
            </button>
        </form>
    </div>

    <div style="margin-top: 40px;">
        <h3 style="font-size: 18px; color: #444; margin-bottom: 20px; border-left: 4px solid #fbc02d; padding-left: 10px;">ë‚˜ì˜ ì¿ í° ëª©ë¡</h3>

        <div style="display: grid; gap: 15px;">
            {% for uc in user_coupons %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 25px; border: 1px solid #eee; border-radius: 15px; background: {% if uc.is_used %}#fafafa{% else %}#fff{% endif %}; position: relative; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">

                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="background: {% if uc.is_used %}#f0f0f0{% else %}#fffde7{% endif %}; color: {% if uc.is_used %}#aaa{% else %}#f57f17{% endif %}; padding: 15px; border-radius: 12px; text-align: center; min-width: 90px;">
                        <span style="font-size: 20px; font-weight: 800;">
                            {% if uc.coupon.discount_type == 'amount' %}
                                {{ uc.coupon.discount_value|floatformat:0 }}ì›
                            {% else %}
                                {{ uc.coupon.discount_value|floatformat:0 }}%
                            {% endif %}
                        </span>
                    </div>

                    <div>
    <div style="font-weight: 700; font-size: 17px; color: {% if uc.is_used %}#999{% else %}#333{% endif %};">{{ uc.coupon.name }}</div>
    <div style="font-size: 13px; color: #aaa; margin-top: 4px;">ìµœì†Œ ì£¼ë¬¸: {{ uc.coupon.min_purchase_amount|intcomma }}ì›</div>
    
    {# âœ… ìµœëŒ€ í• ì¸ ê¸ˆì•¡ í‘œì‹œ ì¶”ê°€ #}
    {% if uc.coupon.max_discount_amount %}
    <div style="font-size: 13px; color: #e44d26; margin-top: 2px; font-weight: 500;">
        ìµœëŒ€ í• ì¸: {{ uc.coupon.max_discount_amount|intcomma }}ì›
    </div>
    {% endif %}
</div>
                </div>

                <div style="text-align: right; z-index: 1;">
                    <div style="margin-bottom: 10px;">
                        {% if uc.is_used %}
                            <span style="background: #eee; color: #999; padding: 5px 12px; border-radius: 30px; font-size: 11px; font-weight: bold;">ì‚¬ìš©ì™„ë£Œ</span>
                        {% else %}
                            <span style="background: #e8f5e9; color: #2e7d32; padding: 5px 12px; border-radius: 30px; font-size: 11px; font-weight: bold;">ì‚¬ìš©ê°€ëŠ¥</span>
                        {% endif %}
                    </div>
                    <div style="font-size: 12px; color: #ccc;">{{ uc.coupon.valid_to|date:"Y-m-d" }}ê¹Œì§€</div>
                </div>

                <div style="position: absolute; left: -12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; background: #fdfdfd; border-radius: 50%; border: 1px solid #eee;"></div>
                <div style="position: absolute; right: -12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; background: #fdfdfd; border-radius: 50%; border: 1px solid #eee;"></div>
            </div>
            {% empty %}
            <div style="text-align: center; padding: 60px; color: #ccc; border: 2px dashed #f0f0f0; border-radius: 20px;">ë³´ìœ í•˜ì‹  ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
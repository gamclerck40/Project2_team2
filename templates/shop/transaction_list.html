{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ë‚˜ì˜ ê±°ë˜ ë‚´ì—­</h2>

    <div class="tab-menu" style="display: flex; gap: 5px; margin-bottom: 20px;">
        <button onclick="openTab('in-tab')" class="tab-btn active" id="defaultOpen" style="padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; border-bottom: none; border-radius: 8px 8px 0 0; background: #f8f9fa; font-weight: bold;">
            ğŸ’° ì…ê¸ˆ ë‚´ì—­
        </button>
        <button onclick="openTab('out-tab')" class="tab-btn" style="padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; border-bottom: none; border-radius: 8px 8px 0 0; background: #f8f9fa; font-weight: bold;">
            ğŸ›ï¸ ì¶œê¸ˆ/êµ¬ë§¤ ë‚´ì—­
        </button>
    </div>

    <div id="in-tab" class="tab-content" style="display: block; border: 1px solid #ccc; padding: 20px; border-radius: 0 0 8px 8px;">
        <h3 style="color: #28a745;">ì…ê¸ˆ ë‚´ì—­ (IN)</h3>
        <table class="table w-100">
            <thead class="table-light">
                <tr>
                    <th>ë‚ ì§œ</th>
                    <th>ê³„ì¢Œ</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ë©”ëª¨</th>
                </tr>
            </thead>
            <tbody>
                {% for tx in transactions %}
                    {% if tx.tx_type == "IN" %}
                    <tr>
                        <td>{{ tx.occurred_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ tx.account.account_number }}</td>
                        <td style="color: #28a745; font-weight: bold;">+{{ tx.amount|intcomma }}ì›</td>
                        <td>{{ tx.memo|default:"-" }}</td>
                    </tr>
                    {% endif %}
                {% empty %}
                    <tr><td colspan="4" class="text-center">ì…ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="out-tab" class="tab-content" style="display: none; border: 1px solid #ccc; padding: 20px; border-radius: 0 0 8px 8px;">
        <h3 style="color: #dc3545;">ì¶œê¸ˆ/êµ¬ë§¤ ë‚´ì—­ (OUT)</h3>
        <table class="table w-100">
            <thead class="table-light">
                <tr>
                    <th>ë‚ ì§œ</th>
                    <th>ìƒí’ˆëª…(ìˆ˜ëŸ‰)</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ì¹´í…Œê³ ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for tx in transactions %}
                    {% if tx.tx_type == "OUT" %}
                    <tr>
                        <td>{{ tx.occurred_at|date:"Y-m-d H:i" }}</td>
                        <td>
                            {% if tx.product %}
                                {{ tx.product.name }} ({{ tx.quantity }}ê°œ)
                            {% else %}
                                {{ tx.product_name|default:"ì¼ë°˜ ì§€ì¶œ" }}
                            {% endif %}
                        </td>
                        <td style="color: #dc3545; font-weight: bold;">-{{ tx.amount|intcomma }}ì›</td>
                        <td>{{ tx.category.name|default:"ë¯¸ë¶„ë¥˜" }}</td>
                    </tr>
                    {% endif %}
                {% empty %}
                    <tr><td colspan="4" class="text-center">ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function openTab(tabId) {
    // 1. ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
    var contents = document.getElementsByClassName("tab-content");
    for (var i = 0; i < contents.length; i++) {
        contents[i].style.display = "none";
    }
    
    // 2. ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ (ë°°ê²½ìƒ‰ ì´ˆê¸°í™”)
    var buttons = document.getElementsByClassName("tab-btn");
    for (var i = 0; i < buttons.length; i++) {
        buttons[i].style.background = "#f8f9fa";
        buttons[i].style.borderBottom = "1px solid #ccc";
    }

    // 3. ì„ íƒí•œ íƒ­ë§Œ ë³´ì´ê¸°
    document.getElementById(tabId).style.display = "block";
    
    // 4. ì„ íƒí•œ ë²„íŠ¼ë§Œ í™œì„±í™” ìŠ¤íƒ€ì¼
    event.currentTarget.style.background = "#fff";
    event.currentTarget.style.borderBottom = "none";
}
// ì´ˆê¸° ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ í‘œì‹œ
document.getElementById("defaultOpen").style.background = "#fff";
document.getElementById("defaultOpen").style.borderBottom = "none";
</script>
{% endblock %}